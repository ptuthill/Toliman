# Jupyter Notebooks

These notebooks record various investigations. Most of the important code has been factored out to [`toliman-proper`](../toliman-proper).

# Generating PSFs

* [Toliman simple prescription PSF.ipynb](Toliman simple prescription PSF.ipynb?viewer=nbviewer) Generation of basic PSF using a Proper prescription derived from the HST example.
* [Toliman detector image generation.ipynb](Toliman detector image generation.ipynb?viewer=nbviewer) Build up from single source to two, without phase pupil.
* [Toliman detector image generation with spirals.ipynb](Toliman detector image generation with spirals.ipynb?viewer=nbviewer) Build up from single source to two, and then with spiral phase pupil.
* [toliman PROPER conic RC multi.ipynb](toliman PROPER conic RC multi.ipynb?viewer=nbviewer) Modelling of a single source PSF, including generation of amplitude distribution for each wavelength and then combining to a single detector image.
* [toliman PROPER conic vs quadratic.ipynb](toliman PROPER conic vs quadratic.ipynb?viewer=nbviewer) Compare PSFs for on-axis sources using conic code vs default quadratic mirrors.
* [toliman PROPER conic vs quadratic off-axis.ipynb](toliman PROPER conic vs quadratic off-axis.ipynb?viewer=nbviewer) As above, but try tilting the input wavefronts.


# Phase pupils

* [phase pattern.ipynb](phase pattern.ipynb?viewer=nbviewer) Generate phase patterns according to Kieran's devilish pseudo-code one-liners
* [Validate spiral Fourier Transform.ipynb](Validate spiral Fourier Transform.ipynb?viewer=nbviewer) Check the Fourier transform of the phase pupil, and compare against the reference images provided by Kieran.
* [Validate spiral PSF single lens.ipynb](Validate spiral PSF single lens.ipynb?viewer=nbviewer) Explore PSF for single lens system, avoiding issues of struts and occusions.
* [Validate spiral PSF.ipynb](Validate spiral PSF.ipynb?viewer=nbviewer) Compare PSF generated with Proper using spiral phase pupil to equivalent PSF generated by Zemax.

# Fitting of PSFs

## Single source, Proper vs Zemax

These are challenging since the PSFs differ slightly in form.

* [RC proper fit test.ipynb](RC proper fit test.ipynb?viewer=nbviewer) Fit a single source PSF to a Zemax reference
* [RC proper vs noisy zemax fit test vary position and flux.ipynb](RC proper vs noisy zemax fit test vary position and flux.ipynb?viewer=nbviewer) Fit a monochromatic Proper PSF to a reference Zemax image with Poisson noise.
* [RC proper vs noisy zemax fit test vary position and flux poly.ipynb](RC proper vs noisy zemax fit test vary position and flux poly.ipynb?viewer=nbviewer) As above, but polychromatic.

## Single source, Proper vs Noisy Proper

These all generate a Proper reference PSF and add Poisson noise, and then to to fit a noiseless PSF to it. They avoid the problems with the difference in PSF morphology.

* [RC proper vs noisy proper fit test vary mirror separation.ipynb](RC proper vs noisy proper fit test vary mirror separation.ipynb?viewer=nbviewer) Fit a single source model to a noisy modelled PSF, with mirror separation as free parameter.
* [RC proper vs noisy proper fit test vary position.ipynb](RC proper vs noisy proper fit test vary position.ipynb?viewer=nbviewer) Try Nelder-Mead Simplex from `scypy.optimize` to fit position of single source together, with flux fixed.
* [RC proper vs noisy proper fit test vary position and flux.ipynb](RC proper vs noisy proper fit test vary position and flux.ipynb?viewer=nbviewer) Try a few algorithms from `scypy.optimize` to fit position and flux of single source together.

## Dual sources, Proper vs Noisy Proper
 
* [Binary separation effects.ipynb](Binary separation effects.ipynb?viewer=nbviewer) plots the results of the batch script [batch/spirals_vary_tilt/batch.py](../batch/spirals_vary_tilt/batch.py) to investigate whether the image formed by two PSFs is separable in a convex manner.
* [RC proper vs noisy proper fit test vary position and flux binary.ipynb](RC proper vs noisy proper fit test vary position and flux binary.ipynb?viewer=nbviewer) Use `scypy.optimize` to fit positions and fluxes together.
* [RC proper vs noisy proper fit test vary position and flux binary sequential.ipynb](RC proper vs noisy proper fit test vary position and flux binary sequential.ipynb?viewer=nbviewer) Use `scypy.optimize` to fit positions and fluxes sequentially.
* [RC proper vs noisy proper fit test vary position and flux binary Bayesian.ipynb](RC proper vs noisy proper fit test vary position and flux binary Bayesian.ipynb?viewer=nbviewer) Use `skopt` BO package, with positions and fluxes as free parameters.
* [RC proper vs noisy proper fit test vary position and flux binary sequential Bayesian.ipynb](RC proper vs noisy proper fit test vary position and flux binary sequential Bayesian.ipynb?viewer=nbviewer) Attempt to improve BO fitting by optimising positions and fluxes separately.
* [RC proper vs noisy proper fit test vary position and flux binary cross-corr and BO.ipynb](RC proper vs noisy proper fit test vary position and flux binary cross-corr and BO.ipynb?viewer=nbviewer) Improve BO fitting by first fitting with image cross-correlation.

# Others

* [FFT comparison.ipynb](FFT comparison.ipynb?viewer=nbviewer) quick test of using different FFT libraries. A more thorough comparison is done in [batch/FFT_compare/](../batch/FFT_compare/).
* [Load Zemax txtfile and save as Numpy file.ipynb](Load Zemax txtfile and save as Numpy file.ipynb?viewer=nbviewer) Example of how to read in the `.txt` PSF files generated by Zemax, and export to Numpy native format.
* [Validate sub-pixel translations.ipynb](Validate sub-pixel translations.ipynb=nbviewer) Check that code for Fourier-domain sub-pixel translation of PSF works. 
* [Validate tilted wavefront.ipynb](Validate tilted wavefront.ipynb?viewer=nbviewer) Check that `prop_tilt.py` code correctly offsets the PSF for an off-axis source.
* [conic validation.ipynb](conic validation.ipynb?viewer=nbviewer) Testing of code for conic optics.
* [prop_magnify test.ipynb](prop_magnify test.ipynb?viewer=nbviewer) Investigate Proper's broken `prop_magnify` function (now fixed)